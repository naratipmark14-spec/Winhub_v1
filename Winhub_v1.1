local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

-- [[ ระบบจัดการเสียง ]]
local clickSound = Instance.new("Sound", workspace)
clickSound.SoundId = "rbxassetid://1673280232"
local function playClick() clickSound:Play() end

-- [[ ฟังก์ชันทำให้ลากได้ (PC & Mobile) ]]
local function makeDraggable(obj)
	local dragging, dragInput, dragStart, startPos
	obj.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true; dragStart = input.Position; startPos = obj.Position
		end
	end)
	obj.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)
	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - dragStart
			obj.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)
	obj.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = false
		end
	end)
end

-- [[ สร้าง UI หลัก ]]
local ScreenGui = Instance.new("ScreenGui", player.PlayerGui)
ScreenGui.Name = "WinHub_V5"
ScreenGui.ResetOnSpawn = false

local MainContainer = Instance.new("Frame", ScreenGui)
MainContainer.Size = UDim2.new(0, 550, 0, 350) -- ปรับ Frame ให้ใหญ่ขึ้นตามคำขอ
MainContainer.Position = UDim2.new(0.5, -275, 0.5, -175)
MainContainer.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
MainContainer.BorderSizePixel = 0
Instance.new("UICorner", MainContainer).CornerRadius = UDim.new(0, 10)
makeDraggable(MainContainer)

-- Header
local iconHL = Instance.new("ImageLabel", MainContainer)
iconHL.Size = UDim2.new(0, 30, 0, 30)
iconHL.Position = UDim2.new(0, 10, 0, 10)
iconHL.Image = "rbxassetid://6228441155"
iconHL.BackgroundTransparency = 1

local titleLabel = Instance.new("TextLabel", MainContainer)
titleLabel.Text = "วิน Hub"
titleLabel.Size = UDim2.new(0, 100, 0, 30)
titleLabel.Position = UDim2.new(0, 45, 0, 10)
titleLabel.BackgroundTransparency = 1
titleLabel.TextColor3 = Color3.new(1, 1, 1)
titleLabel.TextSize = 18
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextXAlignment = Enum.TextXAlignment.Left

-- ปุ่ม ปิด/ย่อ
local closeGuiBtn = Instance.new("TextButton", MainContainer)
closeGuiBtn.Text = "X"; closeGuiBtn.Size = UDim2.new(0, 30, 0, 30); closeGuiBtn.Position = UDim2.new(1, -35, 0, 5)
closeGuiBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50); closeGuiBtn.TextColor3 = Color3.new(1, 1, 1); Instance.new("UICorner", closeGuiBtn)

local minGuiBtn = Instance.new("TextButton", MainContainer)
minGuiBtn.Text = "-"; minGuiBtn.Size = UDim2.new(0, 30, 0, 30); minGuiBtn.Position = UDim2.new(1, -70, 0, 5)
minGuiBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60); minGuiBtn.TextColor3 = Color3.new(1, 1, 1); Instance.new("UICorner", minGuiBtn)

-- Sidebar
local Sidebar = Instance.new("Frame", MainContainer)
Sidebar.Size = UDim2.new(0, 100, 1, -50); Sidebar.Position = UDim2.new(0, 10, 0, 45); Sidebar.BackgroundTransparency = 1
local sidebarLayout = Instance.new("UIListLayout", Sidebar); sidebarLayout.Padding = UDim.new(0, 5)

local mainTabBtn = Instance.new("TextButton", Sidebar)
mainTabBtn.Text = "Main"; mainTabBtn.Size = UDim2.new(1, 0, 0, 35); mainTabBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 45); mainTabBtn.TextColor3 = Color3.new(1, 1, 1); Instance.new("UICorner", mainTabBtn)

local settingTabBtn = Instance.new("TextButton", Sidebar)
settingTabBtn.Text = "Setting"; settingTabBtn.Size = UDim2.new(1, 0, 0, 35); settingTabBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 45); settingTabBtn.TextColor3 = Color3.new(1, 1, 1); Instance.new("UICorner", settingTabBtn)

-- ScrollingFrames
local MainFrame = Instance.new("ScrollingFrame", MainContainer)
MainFrame.Size = UDim2.new(1, -130, 1, -60); MainFrame.Position = UDim2.new(0, 120, 0, 50); MainFrame.BackgroundTransparency = 1; MainFrame.Visible = true; MainFrame.CanvasSize = UDim2.new(0,0,2,0)

local SettingFrame = Instance.new("ScrollingFrame", MainContainer)
SettingFrame.Size = UDim2.new(1, -130, 1, -60); SettingFrame.Position = UDim2.new(0, 120, 0, 50); SettingFrame.BackgroundTransparency = 1; SettingFrame.Visible = false; SettingFrame.CanvasSize = UDim2.new(0,0,2,0)

-- [[ ปุ่มย่อ (Mini Icon) ]]
local MiniButton = Instance.new("ImageButton", ScreenGui)
MiniButton.Size = UDim2.new(0, 50, 0, 50); MiniButton.Position = UDim2.new(0, 20, 0, 20); MiniButton.Image = "rbxassetid://6228441155"
MiniButton.Visible = false; MiniButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30); Instance.new("UICorner", MiniButton).CornerRadius = UDim.new(1, 0)
makeDraggable(MiniButton)

minGuiBtn.MouseButton1Click:Connect(function() playClick(); MainContainer.Visible = false; MiniButton.Visible = true end)
MiniButton.MouseButton1Click:Connect(function() playClick(); MainContainer.Visible = true; MiniButton.Visible = false end)
closeGuiBtn.MouseButton1Click:Connect(function() playClick(); ScreenGui:Destroy() end)

-- Tab Switching
mainTabBtn.MouseButton1Click:Connect(function() MainFrame.Visible = true; SettingFrame.Visible = false end)
settingTabBtn.MouseButton1Click:Connect(function() MainFrame.Visible = false; SettingFrame.Visible = true end)

-- [[ 1. ระบบ Setting (WalkSpeed & JumpPower) ]]
local wsLabel = Instance.new("TextLabel", SettingFrame)
wsLabel.Text = "WalkSpeed"; wsLabel.Size = UDim2.new(0, 100, 0, 30); wsLabel.Position = UDim2.new(0, 10, 0, 10); wsLabel.TextColor3 = Color3.new(1,1,1); wsLabel.BackgroundTransparency = 1

local speedbox = Instance.new("TextBox", SettingFrame)
speedbox.Name = "speedbox"; speedbox.Size = UDim2.new(0, 80, 0, 30); speedbox.Position = UDim2.new(0, 120, 0, 10); speedbox.PlaceholderText = "16"; speedbox.BackgroundColor3 = Color3.fromRGB(50,50,50); speedbox.TextColor3 = Color3.new(1,1,1); Instance.new("UICorner", speedbox)

local jpLabel = Instance.new("TextLabel", SettingFrame)
jpLabel.Text = "JumpPower"; jpLabel.Size = UDim2.new(0, 100, 0, 30); jpLabel.Position = UDim2.new(0, 10, 0, 50); jpLabel.TextColor3 = Color3.new(1,1,1); jpLabel.BackgroundTransparency = 1

local jumpbox = Instance.new("TextBox", SettingFrame)
jumpbox.Name = "jumpbox"; jumpbox.Size = UDim2.new(0, 80, 0, 30); jumpbox.Position = UDim2.new(0, 120, 0, 50); jumpbox.PlaceholderText = "50"; jumpbox.BackgroundColor3 = Color3.fromRGB(50,50,50); jumpbox.TextColor3 = Color3.new(1,1,1); Instance.new("UICorner", jumpbox)

speedbox.FocusLost:Connect(function()
	local hum = player.Character and player.Character:FindFirstChild("Humanoid")
	if hum and tonumber(speedbox.Text) then hum.WalkSpeed = tonumber(speedbox.Text) end
end)
jumpbox.FocusLost:Connect(function()
	local hum = player.Character and player.Character:FindFirstChild("Humanoid")
	if hum and tonumber(jumpbox.Text) then hum.JumpPower = tonumber(jumpbox.Text); hum.UseJumpPower = true end
end)

-- [[ 2. ระบบ Main (Fly Gui & Highlight) ]]
local function createRow(name, y, frame)
	local label = Instance.new("TextLabel", frame)
	label.Text = name; label.Size = UDim2.new(0, 150, 0, 30); label.Position = UDim2.new(0, 10, 0, y); label.TextColor3 = Color3.new(1,1,1); label.BackgroundTransparency = 1; label.TextXAlignment = 0
	local btn = Instance.new("TextButton", frame)
	btn.Text = "OPEN"; btn.Size = UDim2.new(0, 70, 0, 30); btn.Position = UDim2.new(0, 170, 0, y); btn.BackgroundColor3 = Color3.fromRGB(0, 150, 255); btn.TextColor3 = Color3.new(1,1,1); Instance.new("UICorner", btn)
	return btn
end

local flyOpenBtn = createRow("Fly Gui By Mark", 10, MainFrame)
local hlOpenBtn = createRow("Highlights Player", 50, MainFrame)

-----------------------------------------------------------
-- [ บริการเสริมสำหรับระบบบิน ]
-----------------------------------------------------------
local fly_active = false
local fly_ui_instance = nil

local function StartFlySystem()
	if fly_ui_instance then 
		fly_ui_instance.Enabled = not fly_ui_instance.Enabled
		flyOpenBtn.Text = fly_ui_instance.Enabled and "CLOSE" or "OPEN"
		return 
	end
	
	flyOpenBtn.Text = "CLOSE"
	local FlyGui = Instance.new("ScreenGui", player.PlayerGui)
	fly_ui_instance = FlyGui
	local FMain = Instance.new("Frame", FlyGui)
	FMain.Size = UDim2.new(0, 200, 0, 200); FMain.Position = UDim2.new(0.8, 0, 0.5, 0); FMain.BackgroundColor3 = Color3.new(0.1,0.1,0.1); makeDraggable(FMain)
	
	local FTitle = Instance.new("TextLabel", FMain); FTitle.Text = "Fly Control"; FTitle.Size = UDim2.new(1,0,0,30); FTitle.TextColor3 = Color3.new(1,1,1)
	local SpeedDisplay = Instance.new("TextLabel", FMain); SpeedDisplay.Text = "Speed: 50"; SpeedDisplay.Position = UDim2.new(0,0,0,35); SpeedDisplay.Size = UDim2.new(1,0,0,25)
	
	local f_btn = Instance.new("TextButton", FMain); f_btn.Text = "Start Fly"; f_btn.Size = UDim2.new(0.9,0,0,35); f_btn.Position = UDim2.new(0.05,0,0,70); f_btn.BackgroundColor3 = Color3.fromRGB(0,100,200)
	local n_btn = Instance.new("TextButton", FMain); n_btn.Text = "Noclip: OFF"; n_btn.Size = UDim2.new(0.9,0,0,35); n_btn.Position = UDim2.new(0.05,0,0,110); n_btn.BackgroundColor3 = Color3.fromRGB(100,50,0)

	local flying = false
	local noclip = false
	local speed = 50
	local bv, bg

	f_btn.MouseButton1Click:Connect(function()
		flying = not flying
		f_btn.Text = flying and "Stop Fly" or "Start Fly"
		f_btn.BackgroundColor3 = flying and Color3.new(0.6,0,0) or Color3.fromRGB(0,100,200)
		local char = player.Character; local root = char and char:FindFirstChild("HumanoidRootPart")
		if flying and root then
			char.Humanoid.PlatformStand = true
			bv = Instance.new("BodyVelocity", root); bv.MaxForce = Vector3.new(1e9,1e9,1e9); bv.Velocity = Vector3.new(0,0,0)
			bg = Instance.new("BodyGyro", root); bg.MaxTorque = Vector3.new(1e9,1e9,game; bg.P = 50000
		else
			if bv then bv:Destroy() end; if bg then bg:Destroy() end
			if char and char:FindFirstChild("Humanoid") then char.Humanoid.PlatformStand = false end
		end
	end)

	n_btn.MouseButton1Click:Connect(function()
		noclip = not noclip
		n_btn.Text = noclip and "Noclip: ON" or "Noclip: OFF"
		n_btn.BackgroundColor3 = noclip and Color3.new(1,0,0) or Color3.fromRGB(100,50,0)
	end)

	RunService.Stepped:Connect(function()
		if noclip and player.Character then
			for _, v in pairs(player.Character:GetDescendants()) do
				if v:IsA("BasePart") then v.CanCollide = false end
			end
		end
		if flying and bv and bg then
			bg.CFrame = workspace.CurrentCamera.CFrame
			bv.Velocity = player.Character.Humanoid.MoveDirection * speed
		end
	end)
end

-----------------------------------------------------------
-- [ ระบบ Highlight Player ]
-----------------------------------------------------------
local hl_ui_instance = nil
local function StartHighlightSystem()
	if hl_ui_instance then 
		hl_ui_instance.Enabled = not hl_ui_instance.Enabled
		hlOpenBtn.Text = hl_ui_instance.Enabled and "CLOSE" or "OPEN"
		return 
	end

	hlOpenBtn.Text = "CLOSE"
	local HL_Gui = Instance.new("ScreenGui", player.PlayerGui); HL_Gui.ResetOnSpawn = false
	hl_ui_instance = HL_Gui
	
	local HLMain = Instance.new("Frame", HL_Gui); HLMain.Size = UDim2.new(0, 250, 0, 200); HLMain.Position = UDim2.new(0.1, 0, 0.5, 0); HLMain.BackgroundColor3 = Color3.fromRGB(30,30,30); makeDraggable(HLMain)
	
	local box = Instance.new("TextBox", HLMain); box.PlaceholderText = "Player Name / All"; box.Size = UDim2.new(0.9,0,0,35); box.Position = UDim2.new(0.05,0,0.2,0)
	local colorBox = Instance.new("TextBox", HLMain); colorBox.PlaceholderText = "Color (แดง, เขียว, ฟ้า...)"; colorBox.Size = UDim2.new(0.9,0,0,35); colorBox.Position = UDim2.new(0.05,0,0.45,0)
	local applyBtn = Instance.new("TextButton", HLMain); applyBtn.Text = "Apply Highlight"; applyBtn.Size = UDim2.new(0.9,0,0,40); applyBtn.Position = UDim2.new(0.05,0,0.7,0); applyBtn.BackgroundColor3 = Color3.fromRGB(0,150,0)

	local colorMap = {["แดง"]=Color3.new(1,0,0), ["เขียว"]=Color3.new(0,1,0), ["ฟ้า"]=Color3.new(0,0.5,1), ["เหลือง"]=Color3.new(1,1,0), ["ขาว"]=Color3.new(1,1,1)}

	applyBtn.MouseButton1Click:Connect(function()
		local target = box.Text:lower()
		local col = colorMap[colorBox.Text] or Color3.new(1,1,1)
		for _, p in pairs(game.Players:GetPlayers()) do
			if target == "all" or p.Name:lower():find(target) then
				if p.Character then
					local h = p.Character:FindFirstChild("HL") or Instance.new("Highlight", p.Character)
					h.Name = "HL"; h.FillColor = col
				end
			end
		end
	end)
end

-- เชื่อมโยงปุ่มใน Main
flyOpenBtn.MouseButton1Click:Connect(function() playClick(); StartFlySystem() end)
hlOpenBtn.MouseButton1Click:Connect(function() playClick(); StartHighlightSystem() end)
