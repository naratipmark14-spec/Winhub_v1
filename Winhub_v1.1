local UserInputService = game:GetService("GetService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "WinHub_Final"
screenGui.Parent = player:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false

local function makeDraggable(obj)
	local dragging, dragInput, dragStart, startPos
	obj.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true; dragStart = input.Position; startPos = obj.Position
		end
	end)
	obj.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)
	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - dragStart
			obj.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)
	obj.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = false
		end
	end)
end

local mainContainer = Instance.new("Frame", screenGui)
mainContainer.Size = UDim2.new(0, 600, 0, 400)
mainContainer.Position = UDim2.new(0.5, -300, 0.5, -200)
mainContainer.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainContainer.BorderSizePixel = 0
Instance.new("UICorner", mainContainer).CornerRadius = UDim.new(0, 12)
makeDraggable(mainContainer)

local title = Instance.new("TextLabel", mainContainer)
title.Text = "วิน Hub"; title.Size = UDim2.new(0, 150, 0, 35); title.Position = UDim2.new(0, 55, 0, 10)
title.BackgroundTransparency = 1; title.TextColor3 = Color3.new(1, 1, 1); title.TextSize = 20; title.Font = Enum.Font.GothamBold; title.TextXAlignment = Enum.TextXAlignment.Left

local closeBtn = Instance.new("TextButton", mainContainer)
closeBtn.Text = "X"; closeBtn.Size = UDim2.new(0, 35, 0, 35); closeBtn.Position = UDim2.new(1, -45, 0, 10)
closeBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50); closeBtn.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0, 8)

local minBtn = Instance.new("TextButton", mainContainer)
minBtn.Text = "-"; minBtn.Size = UDim2.new(0, 35, 0, 35); minBtn.Position = UDim2.new(1, -85, 0, 10)
minBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60); minBtn.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", minBtn).CornerRadius = UDim.new(0, 8)

local sidebar = Instance.new("Frame", mainContainer)
sidebar.Size = UDim2.new(0, 120, 1, -60); sidebar.Position = UDim2.new(0, 10, 0, 55); sidebar.BackgroundTransparency = 1
Instance.new("UIListLayout", sidebar).Padding = UDim.new(0, 10)

local mainTabBtn = Instance.new("TextButton", sidebar)
mainTabBtn.Text = "Main"; mainTabBtn.Size = UDim2.new(1, 0, 0, 40); mainTabBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50); mainTabBtn.TextColor3 = Color3.new(1, 1, 1); Instance.new("UICorner", mainTabBtn)

local settingTabBtn = Instance.new("TextButton", sidebar)
settingTabBtn.Text = "Setting"; settingTabBtn.Size = UDim2.new(1, 0, 0, 40); settingTabBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50); settingTabBtn.TextColor3 = Color3.new(1, 1, 1); Instance.new("UICorner", settingTabBtn)

local mainFrame = Instance.new("ScrollingFrame", mainContainer)
mainFrame.Size = UDim2.new(1, -150, 1, -65); mainFrame.Position = UDim2.new(0, 140, 0, 55); mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40); mainFrame.BorderSizePixel = 0; mainFrame.CanvasSize = UDim2.new(0, 0, 2, 0); Instance.new("UICorner", mainFrame)

local settingFrame = Instance.new("ScrollingFrame", mainContainer)
settingFrame.Size = UDim2.new(1, -150, 1, -65); settingFrame.Position = UDim2.new(0, 140, 0, 55); settingFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40); settingFrame.BorderSizePixel = 0; settingFrame.Visible = false; settingFrame.CanvasSize = UDim2.new(0, 0, 2, 0); Instance.new("UICorner", settingFrame)

local function createRow(f, t, y, c)
	local l = Instance.new("TextLabel", f); l.Text = t; l.Size = UDim2.new(0, 200, 0, 40); l.Position = UDim2.new(0, 20, 0, y); l.BackgroundTransparency = 1; l.TextColor3 = Color3.new(1,1,1); l.TextXAlignment = 0
	local b = Instance.new("TextButton", f); b.Text = "OPEN"; b.Size = UDim2.new(0, 100, 0, 30); b.Position = UDim2.new(1, -120, 0, y+5); b.BackgroundColor3 = c; b.TextColor3 = Color3.new(1,1,1); Instance.new("UICorner", b)
	return b
end

local flyOpen = createRow(mainFrame, "Fly Gui By Mark", 20, Color3.fromRGB(0, 170, 127))
local hlOpen = createRow(mainFrame, "Highlights Player", 70, Color3.fromRGB(0, 120, 255))

local function createSet(t, y)
	local l = Instance.new("TextLabel", settingFrame); l.Text = t; l.Size = UDim2.new(0, 120, 0, 40); l.Position = UDim2.new(0, 20, 0, y); l.BackgroundTransparency = 1; l.TextColor3 = Color3.new(1,1,1); l.TextXAlignment = 0
	local b = Instance.new("TextBox", settingFrame); b.Size = UDim2.new(0, 100, 0, 30); b.Position = UDim2.new(1, -120, 0, y+5); b.BackgroundColor3 = Color3.fromRGB(60,60,60); b.TextColor3 = Color3.new(1,1,1); Instance.new("UICorner", b)
	return b
end

local wsB = createSet("WalkSpeed", 20); local jpB = createSet("JumpPower", 70)
wsB.FocusLost:Connect(function() local h = player.Character.Humanoid; if tonumber(wsB.Text) then h.WalkSpeed = tonumber(wsB.Text) end end)
jpB.FocusLost:Connect(function() local h = player.Character.Humanoid; if tonumber(jpB.Text) then h.UseJumpPower = true; h.JumpPower = tonumber(jpB.Text) end end)

local flyGuiInstance, hlGuiInstance = nil, nil

local function RunFlyScript()
	local sg = Instance.new("ScreenGui", player.PlayerGui); sg.ResetOnSpawn = false; flyGuiInstance = sg
	local mf = Instance.new("Frame", sg); mf.Size = UDim2.new(0, 220, 0, 215); mf.Position = UDim2.new(0.5, 310, 0.5, -107); mf.BackgroundColor3 = Color3.fromRGB(30, 30, 30); Instance.new("UICorner", mf); makeDraggable(mf)
	local titleF = Instance.new("TextLabel", mf); titleF.Size = UDim2.new(1,0,0,35); titleF.Text = "Fly V2"; titleF.TextColor3 = Color3.new(1,1,1); titleF.BackgroundTransparency = 1; titleF.Font = 3
	local spdL = Instance.new("TextLabel", mf); spdL.Size = UDim2.new(0,80,0,25); spdL.Position = UDim2.new(0.5,-40,0,40); spdL.Text = "SPD: 50"; spdL.BackgroundColor3 = Color3.fromRGB(45,45,45); spdL.TextColor3 = Color3.new(0,1,0.6); Instance.new("UICorner", spdL)
	local flying, noclip, spd, bv, bg, mU, mD = false, false, 50, nil, nil, false, false
	local function cb(t,p,s,c) local b = Instance.new("TextButton", mf); b.Text=t; b.Position=p; b.Size=s; b.BackgroundColor3=c; b.TextColor3=Color3.new(1,1,1); Instance.new("UICorner",b); return b end
	local pB = cb("+", UDim2.new(0.72,0,0,40), UDim2.new(0,40,0,25), Color3.fromRGB(60,60,60))
	local mB = cb("-", UDim2.new(0.1,0,0,40), UDim2.new(0,40,0,25), Color3.fromRGB(60,60,60))
	local fvB = cb("FLY", UDim2.new(0.05,0,0,110), UDim2.new(0,198,0,35), Color3.fromRGB(0,120,255))
	local ncB = cb("NOCLIP: OFF", UDim2.new(0.05,0,0,150), UDim2.new(0,198,0,30), Color3.fromRGB(150,75,0))
	local uB = cb("UP", UDim2.new(0.05,0,0,75), UDim2.new(0,95,0,30), Color3.fromRGB(80,80,80))
	local dB = cb("DOWN", UDim2.new(0.52,0,0,75), UDim2.new(0,95,0,30), Color3.fromRGB(80,80,80))
	pB.MouseButton1Click:Connect(function() spd += 10; spdL.Text = "SPD: "..spd end)
	mB.MouseButton1Click:Connect(function() spd = math.max(0, spd-10); spdL.Text = "SPD: "..spd end)
	uB.MouseButton1Down:Connect(function() mU = true end); uB.MouseButton1Up:Connect(function() mU = false end)
	dB.MouseButton1Down:Connect(function() mD = true end); dB.MouseButton1Up:Connect(function() mD = false end)
	ncB.MouseButton1Click:Connect(function() noclip = not noclip; ncB.Text = noclip and "NOCLIP: ON" or "NOCLIP: OFF"; ncB.BackgroundColor3 = noclip and Color3.new(1,0,0) or Color3.fromRGB(150,75,0) end)
	fvB.MouseButton1Click:Connect(function()
		flying = not flying; local char = player.Character; local root = char.HumanoidRootPart
		if flying then fvB.Text = "STOP"; fvB.BackgroundColor3 = Color3.new(0.8,0.2,0.2); char.Humanoid.PlatformStand = true
			bv = Instance.new("BodyVelocity", root); bv.MaxForce = Vector3.new(1e9,1e9,1e9); bg = Instance.new("BodyGyro", root); bg.MaxTorque = Vector3.new(1e9,1e9,1e9); bg.P = 50000
		else fvB.Text = "FLY"; fvB.BackgroundColor3 = Color3.fromRGB(0,120,255); if bv then bv:Destroy() end; if bg then bg:Destroy() end; char.Humanoid.PlatformStand = false end
	end)
	RunService.Stepped:Connect(function()
		local char = player.Character; if not char then return end
		if noclip then for _,v in pairs(char:GetDescendants()) do if v:IsA("BasePart") then v.CanCollide = false end end end
		if flying and bv and bg then bg.CFrame = workspace.CurrentCamera.CFrame
			bv.Velocity = (char.Humanoid.MoveDirection * spd) + Vector3.new(0, (mU and spd or 0) + (mD and -spd or 0), 0) end
	end)
end

local function RunHLScript()
	local sg = Instance.new("ScreenGui", player.PlayerGui); sg.ResetOnSpawn = false; hlGuiInstance = sg
	local mf = Instance.new("Frame", sg); mf.Size = UDim2.new(0, 260, 0, 280); mf.Position = UDim2.new(0.5, -570, 0.5, -140); mf.BackgroundColor3 = Color3.fromRGB(30,30,30); Instance.new("UICorner", mf); makeDraggable(mf)
	local uB = Instance.new("TextBox", mf); uBox = uB; uB.Size = UDim2.new(0.9,0,0,40); uB.Position = UDim2.new(0.05,0,0.15,0); uB.PlaceholderText = "Name/All"; uB.BackgroundColor3 = Color3.fromRGB(50,50,50); uB.TextColor3 = Color3.new(1,1,1); Instance.new("UICorner", uB)
	local cB = Instance.new("TextBox", mf); cBox = cB; cB.Size = UDim2.new(0.9,0,0,40); cB.Position = UDim2.new(0.05,0,0.33,0); cB.PlaceholderText = "Color (แดง, เขียว, ฟ้า...)"; cB.BackgroundColor3 = Color3.fromRGB(50,50,50); cB.TextColor3 = Color3.new(1,1,1); Instance.new("UICorner", cB)
	local aB = Instance.new("TextButton", mf)game.Size = UDim2.new(0.9,0,0,45); aB.Position = UDim2.new(0.05,0,0.75,0); aB.Text = "Apply Highlights"; aB.BackgroundColor3 = Color3.fromRGB(0,150,255); aB.TextColor3 = Color3.new(1,1,1); Instance.new("UICorner", aB)
	local cMap = {["แดง"]=Color3.new(1,0,0),["เขียว"]=Color3.new(0,1,0),["ฟ้า"]=Color3.new(0,0.5,1),["เหลือง"]=Color3.new(1,1,0),["ขาว"]=Color3.new(1,1,1)}
	aB.MouseButton1Click:Connect(function()
		local t = uB.Text:lower(); local col = cMap[cB.Text] or Color3.new(1,1,1)
		for _,p in pairs(Players:GetPlayers()) do
			if t == "all" or p.Name:lower():find(t) or p.DisplayName:lower():find(t) then
				if p.Character then local h = p.Character:FindFirstChild("CustomHL") or Instance.new("Highlight", p.Character); h.Name = "CustomHL"; h.FillColor = col end
			end
		end
	end)
end

flyOpen.MouseButton1Click:Connect(function()
	if not flyGuiInstance then RunFlyScript() end
	flyGuiInstance.Enabled = not flyGuiInstance.Enabled
	flyOpen.Text = flyGuiInstance.Enabled and "CLOSE" or "OPEN"
	flyOpen.BackgroundColor3 = flyGuiInstance.Enabled and Color3.new(0.6,0,0) or Color3.fromRGB(0, 170, 127)
end)

hlOpen.MouseButton1Click:Connect(function()
	if not hlGuiInstance then RunHLScript() end
	hlGuiInstance.Enabled = not hlGuiInstance.Enabled
	hlOpen.Text = hlGuiInstance.Enabled and "CLOSE" or "OPEN"
	hlOpen.BackgroundColor3 = hlGuiInstance.Enabled and Color3.new(0.6,0,0) or Color3.fromRGB(0, 120, 255)
end)

closeBtn.MouseButton1Click:Connect(function() screenGui:Destroy(); if flyGuiInstance then flyGuiInstance:Destroy() end; if hlGuiInstance then hlGuiInstance:Destroy() end end)
minBtn.MouseButton1Click:Connect(function() mainContainer.Visible = not mainContainer.Visible end)
mainTabBtn.MouseButton1Click:Connect(function() mainFrame.Visible = true; settingFrame.Visible = false end)
settingTabBtn.MouseButton1Click:Connect(function() mainFrame.Visible = false; settingFrame.Visible = true end)
